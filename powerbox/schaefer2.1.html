<!DOCTYPE html>
<html>
    <head>
        <title>Powerbox: Power Calculator</title>
        <script>
            /**
             * todo:
             * theme song
             * tool tips
             * finish out series, options
             * 
             * */
            </script>
        <style>
            body {
                background: red;
                padding: 1ex;
                margin-top: 5em;
                margin-bottom: 3em;
            }

            .floating-header {
                text-align: center;
                background: inherit;
                color: white;
                position: fixed;
                width: 80%;
                top: 0px;
                margin-top: 0.5em;
                padding: 10px 0px;
                left: 10%;
                border-radius: 1em;
            }

            .floating-footer {
                text-align: center;
                background: yellow;
                color: black;
                position: fixed;
                width: 100%;
                bottom: 0px;
                left: 0px;
            }

            .floating-footer * {
                background: inherit;
            }

            body * {
                background:white;
                font-family: Verdana, sans-serif;
            }

            .input-section-container {
                margin: 1ex;
                border: black 1px solid;
                border-radius: 1ex;
                padding: 5px;
                text-align: center;
            }

            .input-section-container input {
                width: 12ex;
            }

            #input-data {
                margin: 1ex;
                border: black 1px solid;
                border-radius: 2ex;
                padding: 5px;
            }

            #input-data table {
                width: 100%;
            }

            #input-data > * {
                flex-grow: 1;
            }

            #all-products {
                background: black;
                margin: 1ex;
                border: black 1px solid;
                border-radius: 2ex;
            }

            schaefer-power-converter {
                background:white;
                margin: 1ex;
                border: black 1px solid;
                border-radius: 1ex;
                padding: 5px;
            }

            schaefer-power-converter > * {
                padding: 2px 5px;
            }

            #schaefer-options-selection {
                display: flex;
                flex-wrap: wrap;
            }

            #schaefer-options-selection span {
                flex-grow: 1;
            }

            schaefer-catalogue-number {
                font-weight: bold;
            }
        </style>
    </head>
    <body onload="doSearch()">
        <h1 class="floating-header">Powerbox Australia</h1>
        <div id="input-data" style="display: flex; flex-flow: row wrap; justify-content: space-between;">
            <div id="financial-data" class="input-section-container" style="align-self: flex-start;">
                <h2>Financial Data</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Exchange rate</th>
                            <td>$1 AUD = &euro;<input id="exchange-rate-input" type="number" oninput="
                                for ( const element of document.getElementsByTagName('exchange-price') ) {
                                    element.setAttribute('exchange-rate', this.value);
                                }
                            "></td>
                        </tr>
                        <tr>
                            <th>Postage and Insurance</th>
                            <td><input id="postage-and-insurance-rate-input" type="number" oninput="
                                for ( const element of document.getElementsByTagName('exchange-price') ) {
                                    element.setAttribute('postage-and-insurance', this.value);
                                }
                            ">&percnt;</td>
                        </tr>
                        <tr>
                            <th>Gross Profit</th>
                            <td><input id="gross-profit-rate-input" type="number" oninput="
                                for ( const element of document.getElementsByTagName('exchange-price') ) {
                                    element.setAttribute('gross-profit', this.value);
                                }
                            ">&percnt;</td>
                        </tr>
                    </thead>
                </table>
            </div>
            <div id="product-search-data" class="input-section-container" oninput="doSearch();">
                <h2>Product search</h2>
                <b>Input:</b> 
                <select oninput="
                    switch(this.value) {
                        case 'range':
                            document.getElementById('input-voltage-range-container').style.display = 'block';
                            document.getElementById('input-voltage-nominal-container').style.display = 'none';
                        break;
                        case 'nominal':
                            document.getElementById('input-voltage-range-container').style.display = 'none';
                            document.getElementById('input-voltage-nominal-container').style.display = 'block';
                        break;

                        default:
                            console.error('Product search: input range/nominal selector missing value');
                    }
                " value="nominal">
                    <option value="nominal">nominal</option>
                    <option value="range">range</option>
                </select>
                <span id="input-voltage-range-container" style="display: none;">
                    <input id="input-voltage-min" 
                        type="number" 
                        oninput="
                            document.getElementById('input-voltage-nom').value = 
                                ( Number(this.value) + Number(document.getElementById('input-voltage-max').value) )/2;
                        " 
                        style="width: 10ex;">
                    -
                    <input id="input-voltage-max" 
                    type="number" 
                    oninput="
                        document.getElementById('input-voltage-nom').value = 
                            ( Number(this.value) + Number(document.getElementById('input-voltage-min').value) )/2;
                    " 
                    style="width: 10ex;">
                </span>
                <span id="input-voltage-nominal-container">
                    <input id="input-voltage-nom" 
                    type="number" 
                    oninput="
                        document.getElementById('input-voltage-min').value = this.value;
                        document.getElementById('input-voltage-max').value = this.value;
                    " 
                    style="width: 10ex;">
                </span>
                V
                <select id="input-current-type"></select>
                <br>
                <b>Output:</b>
                <span id="output-voltage-nominal-container">
                    <input id="output-voltage-nom"
                    type="number"
                    oninput=""
                    style="width: 10ex;">
                </span>
                V
                <select id="output-current-type"></select>
                @
                <input id="output-current" type="number">
                A
                <br>
            </div>
            <div id="all-options" class="input-section-container">
                <h2>Required Options</h2>
                <div id="schaefer-options-selection"></div>
                <span id="option-listing" style="display: none;"></span>
            </div>
        </div>

        <div id="all-products">

        </div>

        <div class="floating-footer">
            <span style="font-weight: bold; text-align: left;">Note:</span>
            <br>
            <span>Standard enclosure is Eurocassette - if you specify this you must include sub-rack options - these are not included in this calculator. <i>Excludes C 5600/5700 Series which is 19" 6RU.</i> </span>
        </div>

        <!-- internal operation -->
        <script>
            var tester = null;

            class current_type {
                #tag;
                #type;
                #long;

                constructor(tag, type, long) {
                    this.#tag = tag;
                    this.#type = type;
                    this.#long = long;

                    const option = document.createElement('option');
                    option.value = this.longName;
                    option.innerHTML = this.longName;

                    document.getElementById("input-current-type").append(option.cloneNode(true));
                    document.getElementById("output-current-type").append(option.cloneNode(true));
                }

                get name() { return this.#type; }
                get longName() { return this.#long; }
                get tag() { return this.#tag; }

                static DC = new current_type("DC", "DC", "DC");
                static BC = new current_type("BC", "DC", "Battery Charger");
                static AC = new current_type("AC", "AC", "AC (Single phase)");
                static AC3 = new current_type("AC3", "AC/3", "AC (Three phase)");
            };


            class voltage_range {
                #min; #nom; #max; #val; #ext;

                constructor(min, nom, max) {
                    this.#min = min;
                    this.#nom = nom;
                    this.#max = max;
                }

                get min() { return this.#min; }
                get minimum() { return this.min; }
                get nom() { return this.#nom; }
                get nominal() { return this.nom; }
                get max() { return this.#max; }
                get maximum() { return this.max; }
            };

            class voltage_type {
                #range;
                #type;
                #value;

                constructor(range, type, valstr) {
                    this.#range = range;
                    this.#type = type;

                    this.#value = valstr;
                }

                get range() { return this.#range; }
                get type() { return this.#type; }
                get value() { return this.#value[0]; }
                get extension() { return this.#value[1] ?? ''; }

                getElement() {
                    const span = document.createElement('span');
                    span.innerHTML = `${this.range.nominal}V${this.type.name}&nbsp;[<i>Range:&nbsp;${this.range.minimum}-${this.range.maximum}V${this.type.name}</i>]`;

                    span.internal = this;
                    return span;
                }
            };

            class input_type extends voltage_type {
                constructor(range, type, valstr) {
                    super(range, type, valstr);
                }
            };

            class powerInputElement extends HTMLElement {
                constructor() { super(); }

                static observedAttributes = ['min', 'nom', 'max', 'type'];

                attributeChangedCallback(name, oldValue, newValue) {
                    var str = '<span>Input:</span> ';
                    if ( this.hasAttribute('nom') ) str += `${this.getAttribute('nom')}V${this.getAttribute('type')} `;

                    if ( this.hasAttribute('min') && this.hasAttribute('max') ) str += `[Range: ${this.getAttribute('min')}-${this.getAttribute('max')}V${this.getAttribute('type')}]`;
                    else if ( this.hasAttribute('min') ) str += `[min: ${this.getAttribute('min')}V${this.getAttribute('type')}]`;
                    else if ( this.hasAttribute('max') ) str += `[max: ${this.getAttribute('max')}V${this.getAttribute('type')}]`;

                    this.innerHTML = str;
                }
            }

            customElements.define('power-input', powerInputElement);

            class output_type extends voltage_type {
                #current;

                constructor(range, type, current, valstr) {
                    super(range, type, valstr);
                    this.#current = current;
                }

                get current() { return this.#current; }
                getElement() {
                    const span = super.getElement();
                    span.innerHTML += `&nbsp;@&nbsp;${this.current}A`;

                    span.internal = this;
                    return span;
                }
            };

            class powerOutputElement extends HTMLElement {
                constructor() { super(); }

                static observedAttributes = ['min', 'nom', 'max', 'type', 'current'];

                attributeChangedCallback(name, oldValue, newValue) {
                    if ( !this.hasAttribute('type') ) return;
                    var str = '<span>Output:</span> ';
                    if ( this.hasAttribute('nom') ) str += `${this.getAttribute('nom')}V${this.getAttribute('type')} `;

                    if ( this.hasAttribute('min') && this.hasAttribute('max') ) str += `[Range: ${this.getAttribute('min')}-${this.getAttribute('max')}V${this.getAttribute('type')}]`;
                    else if ( this.hasAttribute('min') ) str += `[min: ${this.getAttribute('min')}V${this.getAttribute('type')}]`;
                    else if ( this.hasAttribute('max') ) str += `[max: ${this.getAttribute('max')}V${this.getAttribute('type')}]`;

                    if ( this.hasAttribute('current') ) str += ` @ ${this.getAttribute('current')}A`;

                    this.innerHTML = str;
                }

                get min() { return Number(this.getAttribute('min')) ?? null; }
                get nom() { return Number(this.getAttribute('nom')) ?? null; }
                get max() { return Number(this.getAttribute('max')) ?? null; }
                get type() { return Number(this.getAttribute('type')) ?? null; }
                get current() { return Number(this.getAttribute('current')) ?? null; }
            }

            customElements.define('power-output', powerOutputElement);

            class catalogue_old {
                #baseStr;
                #options;

                constructor(family, vIn, vOut, optionList) {
                    this.#baseStr = family.slice(0, -2) + vIn.value + vOut.value;
                    if ( vIn.extension || vOut.extension ) this.#baseStr += ` ${vIn.extension}${vOut.extension}`;
                }

                get basename() { return this.#baseStr; }
                getElement() {
                    const string = String(this.#baseStr);

                    // add option -'s

                    const span = document.createElement('span');
                    span.innerText = string;

                    span.internal = this;
                    return span;
                }
            }
            
            class catalogue {
                #element

                constructor(family, vIn, vOut, optionList) {
                    this.#element = document.createElement('schaefer-catalogue-number');
                    this.#element.setAttribute('family', family);
                    this.#element.setAttribute('input-id', vIn.value + (vIn.extension ?? ""));
                    this.#element.setAttribute('output-id', vOut.value + (vOut.extension ?? ""));

                    var appliedOptions = [];
                    for ( var option of optionList ) {
                        if ( option.added ) {
                            appliedOptions.push(option.tag);
                        }
                    }

                    this.#element.setAttribute('options', appliedOptions.join(' '));
                }

                getElement() {
                    return this.#element;
                }
            }

            class schaeferCatalogueNumberElement extends HTMLElement {
                constructor() {
                    super();
                }

                static observedAttributes = ['family', 'input-id', 'output-id', 'options', 'special-id'];

                connectedCallback() {
                    this.parentElement.sku = this;
                }

                attributeChangedCallback(name, oldValue, newValue) {
                    if ( oldValue == newValue ) return;

                    const family = this.getAttribute('family') ?? "no family  ";
                    const input = this.getAttribute('input-id') ?? "0";
                    const output = this.getAttribute('output-id') ?? "0";

                    var str = `${family.slice(0, -2)}${input[0]}${output[0]}`;
                    if ( input[1] || output[1] ) str += ` ${input[1] ?? ""}${output[1] ?? ""}`;
                    
                    if ( this.hasAttribute('special-id') ) {
                        str += this.getAttribute('special-id');
                    } else if ( this.hasAttribute('options') ) {
                        for ( var option of this.getAttribute('options').split(' ') ) {
                            if ( option != "" ) str += `-${option}`;
                        }    
                    }
                    this.innerHTML = str;
                }
            }

            customElements.define('schaefer-catalogue-number', schaeferCatalogueNumberElement);

            class cooling {
                #type;
                constructor(type) {
                    this.#type = type;
                }

                get type() { return this.#type; }

                static convection = new cooling('convection');
                static fan = new cooling('fan');
                static water = new cooling('water');
            };

            class exchangePriceElement extends HTMLElement {
                constructor() { super(); }

                static observedAttributes = ['cost', 'options', 'instrument', 'postage-and-insurance', 'exchange-rate', 'gross-profit'];

                connectedCallback() {
                    this.setAttribute('postage-and-insurance', document.getElementById('postage-and-insurance-rate-input').value);
                    this.setAttribute('exchange-rate', document.getElementById('exchange-rate-input').value);
                    this.setAttribute('gross-profit', document.getElementById('gross-profit-rate-input').value);
                }

                attributeChangedCallback(name, oldValue, newValue) {
                    if ( oldValue == newValue ) return;

                    var cost = Number(this.getAttribute('cost'));
                    var add = this.getAttribute('options');
                    if ( add != null ) {
                        add = add.split(' ');
                        for ( const val of add ) cost += Number(val);
                    }
                    const pni = Number(this.getAttribute('postage-and-insurance'))/100;
                    const exch = Number(this.getAttribute('exchange-rate'));
                    const gp = Number(this.getAttribute('gross-profit'))/100;

                    this.innerHTML = '$' + (cost / exch * (1 + pni) / (1 - gp)).toFixed(2);
                }
            }
            customElements.define('exchange-price', exchangePriceElement);
            
            class baseOption {
                #tag;
                #short;
                #long;
                #price_fn;
            		
                constructor(tag, short, long, price_fn) {
                    this.#tag = tag;
                    this.#short = short;
                    this.#long = long;
                    this.#price_fn = price_fn;

                    //console.log(`adding option ${this.tag}`);
                }
                
                get tag() { return this.#tag; }
                get short() { return this.#short; }
                get long() { return this.#long; }
                get price_fn() { return this.#price_fn; }

                static change_selection(value, tag) {
                    var option;
                    for ( option of options ) if ( option.tag == tag ) break;

                    var optionListing= document.getElementById('option-listing').innerText;

                    if ( value ) {
                        // add price and tag
                        if ( optionListing == "" ) optionListing = tag;
                        else optionListing += ` ${tag}`;

                        for ( const element of document.getElementsByTagName('schaefer-power-converter') ) {
                            // add price to list
                            const price = option.price_fn(element);
                            if ( price == null ) continue;
                            //console.log(element.catNumber, price);
                            var prices = (element.price.getAttribute('options') ?? '').split(' ');
                            if ( prices[0] == '' ) element.price.setAttribute('options', price);
                            else {
                                prices.push(price);
                                element.price.setAttribute('options', prices.join(' '));
                            }
                            // add to tag to catNumber
                            var tags = (element.catNumber.getAttribute('options') ?? '').split(' ');
                            if ( tags[0] == '' ) element.catNumber.setAttribute('options', tag);
                            else {
                                tags.push(tag);
                                element.catNumber.setAttribute('options', tags.join(' '));
                            }
                        }
                    } else {
                        // remove price and tag
                        var optionList = optionListing.split(' ');
                        var index = 0;
                        for ( index in optionList ) if ( optionList[index] == tag ) break;
                        optionList.splice(index, 1);
                        optionListing = optionList.join(' ');

                        for ( const element of document.getElementsByTagName('schaefer-power-converter') ) {
                            if ( !(element.catNumber.getAttribute('options') ?? '').includes(tag) ) continue;
                            var tags = (element.catNumber.getAttribute('options') ?? '').split(' ');
                            var index = 0;
                            for ( index in tags ) if ( tags[index] == tag ) break;
                            tags.splice(index, 1);
                            element.catNumber.setAttribute('options', tags.join(' '));

                            var prices = element.price.getAttribute('options').split(' ');
                            prices.splice(index, 1);
                            element.price.setAttribute('options', prices.join(' '));
                        }
                    }

                    document.getElementById('option-listing').innerText = optionListing;
                    doSearch();
                }

                #element;
                #input;
                #popup;

                createElement() {
                    const span = document.createElement('div');
                    
                    this.#input = document.createElement('input');
                    span.append(this.#input);
                    this.#input.setAttribute('type', 'checkbox');
                    this.#input.setAttribute('onclick', `baseOption.change_selection(this.checked, '${this.tag}')`);
                    
                    span.innerHTML += `&nbsp;${this.short}`;

                    this.#popup = document.createElement('div');
                    this.#popup.id = `${this.tag}-popup`;
                    this.#popup.style.display = 'none';
                    this.#popup.setAttribute('onmouseleave', "this.style.display = 'none';");
                    this.#popup.innerHTML = `${this.short} (<b>${this.tag}</b>): ${this.long}`;

                    const button = document.createElement('span');
                    button.innerHTML = '?';
                    button.style.background = 'yellow';
                    button.style.borderRadius = '1ex';
                    button.style.padding = '0.5ex';
                    button.setAttribute('onclick', `document.getElementById('${this.#popup.id}').style.display = 'block';`);

                    span.append(button);
                    span.append(this.#popup);


                    return span;
                }
            };
            
            class option {
                #tag;
                #short;
                #long;
                #price;
                #added;
                
                constructor(base, psu) {
                    this.#tag = base.tag;
                    this.#short = base.short;
                    this.#long = base.long;
                    this.#price = base.price_fn(psu);
                    this.#added = false;
                }
                
                get tag() { return this.#tag; }
                get short() { return this.#short; }
                get long() { return this.#long; }
                get price() { return this.#price; }
                
                get added() { return this.#added; }
                set added(value) { 
                    this.#added = value; 
                }
                
                getElement() {
                    const span = document.createElement('span');
                    
                    span.innerText = `-${this.tag}`;
                    span.style.display = 'none';
                    
                    span.internal = this;

                    return span;
                }
            }

            class powerShortDescriptionElement extends HTMLElement {
                constructor() { super(); }

                static observedAttributes = ['input-type', 'output-type', 'power'];

                attributeChangedCallback(name, oldValue, newValue) {
                    if ( oldValue == newValue ) return;

                    const input = this.getAttribute('input-type') ?? "";
                    const output = this.getAttribute('output-type') ?? "";
                    const power = this.getAttribute('power') ?? "";

                    this.innerHTML = `${input}/${output} Converter (${power}W)`;
                }
            };

            customElements.define('power-short-description', powerShortDescriptionElement);

            class powerConverterElement extends HTMLElement {
                constructor() {
                    super();
                }
            };
            customElements.define('power-converter', powerConverterElement);

            class schaeferPowerConverterElement extends powerConverterElement {
                #catNumber;
                #shortDescription;
                #input;
                #output;
                #price;
                #options;

                constructor() {
                    super();

                    this.#catNumber = document.createElement('schaefer-catalogue-number');
                    this.#shortDescription = document.createElement('power-short-description');
                    this.#input = document.createElement('power-input');
                    this.#output = document.createElement('power-output');
                    this.#price = document.createElement('exchange-price');
                }

                connectedCallback() {
                    this.innerHTML = '';
                    this.append("Schaefer ", this.#catNumber, this.#shortDescription, this.#input, this.#output, this.#price, document.createElement('br'));
                }

                get catNumber() { return this.#catNumber; }
                get shortDescription() { return this.#shortDescription; }
                get input() { return this.#input; }
                get output() { return this.#output; }
                get price() { return this.#price; }
                get series() { return Number(this.catNumber.getAttribute('family').split(' ')[1]); }
                get power() { return Number(this.shortDescription.getAttribute('power')); }
            };
            customElements.define('schaefer-power-converter', schaeferPowerConverterElement);

            class power_converter {
                #element

                constructor(family, price_euro, input, output, power, cooling, optionsList) {
                    this.#element = document.createElement('schaefer-power-converter');

                    this.#element.catNumber.setAttribute('family', family);
                    this.#element.catNumber.setAttribute('input-id', input.value + input.extension);
                    this.#element.catNumber.setAttribute('output-id', output.value + output.extension);

                    this.#element.shortDescription.setAttribute('input-type', input.type.longName);
                    this.#element.shortDescription.setAttribute('output-type', output.type.longName);
                    this.#element.shortDescription.setAttribute('power', power);

                    this.#element.input.setAttribute('type', input.type.longName);
                    this.#element.input.setAttribute('min', input.range.min);
                    this.#element.input.setAttribute('nom', input.range.nom);
                    this.#element.input.setAttribute('max', input.range.max);

                    this.#element.output.setAttribute('type', output.type.longName);
                    this.#element.output.setAttribute('min', output.range.min);
                    this.#element.output.setAttribute('nom', output.range.nom);
                    this.#element.output.setAttribute('max', output.range.max);
                    this.#element.output.setAttribute('current', output.current);

                    this.#element.price.setAttribute('instrument', 'EUR');
                    this.#element.price.setAttribute('cost', price_euro);

                    this.#element.internal = this;
                }

                getElement() { return this.#element; }

                get catNumber() { return this.#element.catNumber; }
                get input() { return this.#element.input; }
                get output() { return this.#element.output; }
                get price() { return this.#element.price; }
                get power() { return this.#element.power; }
            };

            var product_list = [];

            function add_power_converter_column(family, price_fn, power, input, outputList, currentList, coolingList, optionsList) {
                for ( var i in outputList ) {
                    const output = new output_type(outputList[i].range, outputList[i].type, currentList[i], outputList[i].value + outputList[i].extension);
                    const cooling = coolingList[i];
                    const price = price_fn(input, output);

                    const psu = new power_converter(family, price, input, output, power, cooling, optionsList);
                    product_list.push(psu);
                }
            }

            function add_power_converter_family(family, price_fn_fn, power_fn, inputList, outputList, current_fn, cooling_fn, optionsList) {
                for ( var vIn of inputList ) {
                    const power = power_fn(vIn);
                    const price_fn = price_fn_fn(vIn);
                    const currentList = current_fn(power);
                    const coolingList = cooling_fn(vIn, outputList);

                    add_power_converter_column(family, price_fn, power, vIn, outputList, currentList, coolingList, optionsList);
                }
            }

            const DC = {
                i0:  new voltage_type(new voltage_range(10, 12, 16), current_type.DC, "0"),
                i2:  new voltage_type(new voltage_range(18, 24, 36), current_type.DC, "2"),
                i3:  new voltage_type(new voltage_range(36, 48, 75), current_type.DC, "3"),
                i4:  new voltage_type(new voltage_range(45, 60, 90), current_type.DC, "4"),
                i5:  new voltage_type(new voltage_range(80, 110, 160), current_type.DC, "5"),
                i7:  new voltage_type(new voltage_range(160, 220, 320), current_type.DC, "7"),
                i8Z: new voltage_type(new voltage_range(320, 330, 380), current_type.DC, "8Z"),
                i7G: new voltage_type(new voltage_range(320, 440, 640), current_type.DC, "7G"),

                o0: new voltage_type(new voltage_range(4.5, 5, 5.5), current_type.DC, '0'),
                o1: new voltage_type(new voltage_range(8, 9, 10),    current_type.DC, '1'),
                o2: new voltage_type(new voltage_range(11, 12, 13), current_type.DC, '2'),
                o3: new voltage_type(new voltage_range(14, 15, 16), current_type.DC, '3'),
                o4: new voltage_type(new voltage_range(23, 24, 26), current_type.DC, '4'),
                o5: new voltage_type(new voltage_range(26, 28, 30), current_type.DC, '5'),
                o9: new voltage_type(new voltage_range(45, 48, 55), current_type.DC, '9'),
                o6: new voltage_type(new voltage_range(58, 60, 68), current_type.DC, '6'),
                o7: new voltage_type(new voltage_range(100, 110, 130), current_type.DC, '7'),
                o8: new voltage_type(new voltage_range(200, 220, 250), current_type.DC, '8'),
                o7J: new voltage_type(new voltage_range(190, 200, 200), current_type.DC, "7J"),
                o8J: new voltage_type(new voltage_range(380, 400, 400), current_type.DC, "8J"),

                b1: new voltage_type(new voltage_range(12, 12, 16), current_type.BC, '1'),
                b2: new voltage_type(new voltage_range(24, 24, 32), current_type.BC, '2'),
                b4: new voltage_type(new voltage_range(48, 48, 64), current_type.BC, '4'),
                b6: new voltage_type(new voltage_range(60, 60, 80), current_type.BC, '6'),
                b7: new voltage_type(new voltage_range(110, 110, 145), current_type.BC, '7'),
                b8: new voltage_type(new voltage_range(220, 220, 290), current_type.BC, '8'),
            };

            const AC = {
                i9a: new voltage_type(new voltage_range(100*0.9,230,240*1.1), current_type.AC, '9'),
                i9b: new voltage_type(new voltage_range(100*0.9,110,240*1.1), current_type.AC, '9'),
                i6:  new voltage_type(new voltage_range(115*(1-0.2), 115, 115*(1+0.2)), current_type.AC, '6'),
                i8:  new voltage_type(new voltage_range(230*(1-0.2), 230, 230*(1+0.15)), current_type.AC, '8'),
                i9a: new voltage_type(new voltage_range(115*(1-0.2), 115, 115*(1+0.2)), current_type.AC, '9'),
                i9b: new voltage_type(new voltage_range(230*(1-0.2), 230, 230*(1+0.15)), current_type.AC, '9'),
                i6V: new voltage_type(new voltage_range(200*1.15, 200, 200*0.8), current_type.AC3, '6V')
            };
            
            const options = [
                new baseOption("t", "Tropical protection", "increased protection against hot and humid environments",
                    (psu) => {
                        switch ( psu.series ) {
                            case 200: case 300: 
                                return 28;
                            case 500: case 2500: 
                                return 33;
                            case 600: case 2600:
                            case 1200: case 1300: case 1500: case 3500: case 3700:
                                return 56;
                            case 1600: case 3600: case 3800: case 4500: case 4700:
                                return 94;
                            case 4800: case 4900: case 5000: case 5100: 
                            case 5200: case 5300: case 5400: case 5500: 
                            case 5600: case 5700: case 5800: case 5900:
                                return 153;
                            case 6200: case 6300: case 6400: case 6500:
                            case 6600: case 6700: case 6800:
                                return 211;
                            default:
                                return null;
                        }
                    }
                ),
                new baseOption("ms", "Mechanical strength", "",
                    (psu) => {
                        switch ( psu.series ) {
                            case 200: case 300: 
                                return 33;
                            case 500: case 2500: 
                                return 47;
                            case 600: case 2600:
                            case 1200: case 1300: case 1500: case 3500: case 3700:
                                return 81;
                            case 1600: case 3600: case 3800: case 4500: case 4700:
                                return 119;
                            case 4800: case 4900: case 5000: case 5100: 
                            case 5200: case 5300: case 5400: case 5500: 
                            case 5600: case 5700: case 5800: case 5900:
                                return 200;
                            case 6200: case 6300: case 6400: case 6500:
                            case 6600: case 6700: case 6800:
                                return 346;
                            default:
                                return null
                        }
                    }
                ),
                new baseOption('c', 'extended temperature range', '',
                    (psu) => {
                        switch ( psu.series ) {
                            case 200: case 300: 
                                return 53;
                            case 500: case 2500: 
                                return 87;
                            case 600: case 2600:
                            case 1200: case 1300: case 1500: case 3500: case 3700:
                                return 158;
                            case 1600: case 3600: case 3800: case 4500: case 4700:
                                return 253;
                            case 4800: case 4900: case 5000: case 5100: 
                            case 5200: case 5300: case 5400: case 5500: 
                            case 5600: case 5700: case 5800: case 5900:
                            case 6200: case 6300: case 6400: case 6500:
                            case 6600: case 6700: case 6800:
                                return 424;
                            default:
                                return null
                        }
                    }
                ),
                new baseOption('w', 'wall mount', '',
                    (psu) => {
                        switch ( psu.series ) {
                            case 200: case 300: 
                                return 53; // not available on all models
                            case 500: case 2500: 
                                return 53;
                            case 600: case 2600:
                            case 1200: case 1300: case 1500: case 3500: case 3700:

                            case 1600: case 3600: case 3800: case 4500: case 4700:
                                return 66;
                            case 4800: case 4900: case 5000: case 5100: 
                            case 5200: case 5300: case 5400: case 5500: 
                            case 5600: case 5700: case 5800: case 5900:
                                return 99;
                            case 6200: case 6300: case 6400: case 6500:
                            case 6600: case 6700: case 6800:
                                return 298;
                            default:
                                return null
                        }
                    }
                ),
                new baseOption('sd', 'Input series diode', '',
                    (psu) => {
                        if ( psu.input.getAttribute('type') != 'DC' ) return null;
                        const current = 2 * psu.power / Number(psu.input.getAttribute('min'));
                        if ( current <= 5 ) return 16;
                        if ( current <= 20 ) return 23;
                        if ( current <= 50 ) return 41;
                        if ( current <= 70 ) return 59;
                        if ( current <= 100 ) return 94;
                        if ( current <= 150 ) return 146;
                        if ( current <= 200 ) return 186;
                        if ( current <= 450 ) return 318;
                        return null;
                    }
                ),
                new baseOption('ad', 'Input anti-parallel diode', '',
                    (psu) => {
                        if ( psu.input.getAttribute('type') != 'DC' ) return null;
                        const current = 2 * psu.power / Number(psu.input.getAttribute('min'));
                        if ( current <= 5 ) return 16;
                        if ( current <= 20 ) return 23;
                        if ( current <= 50 ) return 41;
                        if ( current <= 70 ) return 59;
                        if ( current <= 100 ) return 94;
                        if ( current <= 150 ) return 146;
                        if ( current <= 200 ) return 186;
                        if ( current <= 450 ) return 318;
                        return null;
                    }
                ),
                new baseOption('dd', 'Output decoupling diode', '',
                    (psu) => {
                        if ( psu.output.getAttribute('type') != 'DC' ) return null;
                        const current = psu.output.current;
                        if ( current <= 5 ) return 16;
                        if ( current <= 20 ) return 23;
                        if ( current <= 50 ) return 41;
                        if ( current <= 70 ) return 59;
                        if ( current <= 100 ) return 94;
                        if ( current <= 150 ) return 146;
                        if ( current <= 200 ) return 186;
                        if ( current <= 450 ) return 318;
                        return null;
                    }
                ),
                new baseOption('rd', 'Output reverse diode', '',
                    (psu) => {
                        if ( psu.output.getAttribute('type') != 'DC' ) return null;
                        const current = psu.output.current;
                        if ( current <= 5 ) return 16;
                        if ( current <= 20 ) return 23;
                        if ( current <= 50 ) return 41;
                        if ( current <= 70 ) return 59;
                        if ( current <= 100 ) return 94;
                        if ( current <= 150 ) return 146;
                        if ( current <= 200 ) return 186;
                        if ( current <= 450 ) return 318;
                        return null;
                    }
                ),
                new baseOption('cha', 'chassis mount', '',
                    (psu) => {
                        if ( psu.output.current > 60 ) return null;
                        switch ( psu.series ) {
                            case 200: case 300: 
                            case 500: case 2500: 
                                return 28;
                            case 600: case 2600:
                            case 1200: case 1300: case 1500: case 3500: case 3700:
                                return 41;
                            case 1600: case 3600: case 3800: case 4500: case 4700:
                                return 47;
                            case 4800: case 4900: case 5000: case 5100: 
                            case 5200: case 5300: case 5400: case 5500: 
                            case 5600: case 5700: case 5800: case 5900:
                            case 6200: case 6300: case 6400: case 6500:
                            case 6600: case 6700: case 6800:
                                return null;
                            default:
                                return null;
                        }
                    }
                )
            ]

            function create_product_list() {
                product_list = [];

                add_power_converter_family(
                    "CH 200", 
                    () => () => 398, 
                    () => 150, 
                    [ DC.i2, DC.i3, DC.i4, DC.i5, DC.i7 ], 
                    [ DC.o0, DC.o1, DC.o2, DC.o3, DC.o4, DC.o5, DC.o9, DC.o6 ], 
                    (power) => [20, 15, 12, 10, 6, 5, 3, 2.3], 
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "CP 200", 
                    () => () => 398, 
                    () => 150, 
                    [ AC.i9a, AC.i9b ], 
                    [ DC.o0, DC.o1, DC.o2, DC.o3, DC.o4, DC.o5, DC.o9, DC.o6 ], 
                    (power) => [20, 15, 12, 10, 6, 5, 3, 2.3], 
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "BP 200", 
                    () => () => 398, 
                    () => 150, 
                    [ AC.i9a, AC.i9b ], 
                    [ DC.b1, DC.b2, DC.b4, DC.b6 ], 
                    (power) => [10, 5, 2.6, 2], 
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "C 1200", 
                    () => () => 451, 
                    (vIn) => {
                        switch ( vIn.range.nom ) {
                            case 12: return 120;
                            case 24: return 150;
                            default: return 200;
                        }
                    }, 
                    [ DC.i0, DC.i2, DC.i3, DC.i4, DC.i5, DC.i7, DC.i8Z, AC.i6, AC.i8, AC.i9a, AC.i9b ], 
                    [ DC.o0, DC.o1, DC.o2, DC.o3, DC.o4, DC.o5, DC.o9, DC.o6, DC.o7, DC.o8 ], 
                    (power) => {
                        switch ( power ) {
                            case 120: return [ 20, 12, 10, 8, 5, 4, 2.4, 2, 1, 0.5 ];
                            case 150: return [ 25, 15, 12.5, 10, 6, 5, 3, 2.5, 1.2, 0.6 ];
                            default: return [ 30, 18, 15, 12, 7.5, 6.5, 3.6, 3, 1.5, 0.8 ];
                        }
                    }, 
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "B 1200", 
                    () => () => 451, 
                    () => 200,
                    [ AC.i6, AC.i8, AC.i9a, AC.i9b ], 
                    [ DC.b1, DC.b2, DC.b4, DC.b6, DC.b7, DC.b8 ], 
                    () => [12, 6, 3, 2.6, 1.4, 0.7], 
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "C 500",
                    () => () => 476,
                    (vIn) => {
                        switch ( vIn.range.nom ) {
                            case 12: return 180;
                            case 24: return 200;
                            default: return 250;
                        }
                    },
                    [ DC.i0, DC.i2, DC.i3, DC.i4, DC.i5, DC.i7, DC.i8Z, AC.i6, AC.i8, AC.i9a, AC.i9b, AC.i6V ],
                    [ DC.o0, DC.o1, DC.o2, DC.o3, DC.o4, DC.o5, DC.o9, DC.o6, DC.o7, DC.o8 ],
                    (power) => {
                        switch ( power ) {
                            case 180: return [ 25, 17, 14, 11, 7, 6, 3.5, 3, 1.5, 0.8 ];
                            case 200: return [ 30, 20, 16, 13, 8, 7, 4, 3.5, 1.8, 0.9 ];
                            default: return [ 35, 25, 20, 16, 10, 8.5, 4.5, 3.7, 2, 1 ];
                        }
                    },
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "B 500",
                    () => () => 476,
                    (vIn) => 250,
                    [ AC.i6, AC.i8, AC.i9a, AC.i9b, AC.i6V ],
                    [ DC.b1, DC.b2, DC.b4, DC.b6, DC.b7, DC.b8 ],
                    (power) => [16, 8, 4, 3.2, 2, 1],
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "S 600",
                    () => () => 664,
                    (vIn) => {
                        switch ( vIn.range.nom ) {
                            case 12: return 200;
                            case 24: return 300;
                            default: return 350;
                        }
                    },
                    [ DC.i0, DC.i2, DC.i3, DC.i4, DC.i5, DC.i7, DC.i8Z, AC.i6, AC.i8, AC.i9a, AC.i9b, AC.i6V ],
                    [ DC.o0, DC.o1, DC.o2, DC.o3, DC.o4, DC.o5, DC.o9, DC.o6, DC.o7, DC.o8 ],
                    (power) => {
                        switch ( power ) {
                            case 200: return [ 30, 20, 15, 12, 8, 7, 4.4, 3.6, 1.8, 0.9 ];
                            case 300: return [ 50, 30, 24, 20, 12, 10, 6, 5, 2.5, 1.25 ];
                            default: return [ 50, 32, 26, 22, 14, 12, 6.5, 5.2, 3, 1.5 ];
                        }
                    },
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "C 1300",
                    () => () => 604,
                    (vIn) => {
                        switch ( vIn.range.nom ) {
                            case 12: return 250;
                            case 24: return 300;
                            default: return 400;
                        }
                    },
                    [ DC.i0, DC.i2, DC.i3, DC.i4, DC.i5, DC.i7, DC.i8Z, AC.i6, AC.i8, AC.i9a, AC.i9b ],
                    [ DC.o0, DC.o1, DC.o2, DC.o3, DC.o4, DC.o5, DC.o9, DC.o6, DC.o7, DC.o8 ],
                    (power) => {
                        switch ( power ) {
                            case 250: return [ 35, 24, 20, 16, 10, 8.5, 5, 4, 2, 1 ];
                            case 300: return [ 45, 30, 25, 21, 13, 11, 6, 5, 2.5, 1.25 ];
                            default: return [ 50, 35, 30, 25, 15, 13, 7.3, 6, 3, 1.5 ];
                        }
                    },
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "B 1300",
                    () => () => 604,
                    (vIn) => 400,
                    [ AC.i6, AC.i8, AC.i9a, AC.i9b ],
                    [ DC.b1, DC.b2, DC.b4, DC.b6, DC.b7, DC.b8 ],
                    (power) => [25, 12, 6, 4.5, 2.7, 1.4],
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "C 2500",
                    () => () => -1,
                    (vIn) => {
                        switch ( vIn.range.nom ) {
                            case 24: return 300;
                            default: return 400;
                        }
                    },
                    [ DC.i2, DC.i3, DC.i4, DC.i5, DC.i7, DC.i8Z, AC.i6, AC.i8, AC.i9a, AC.i9b, AC.i6V ],
                    [ DC.o0, DC.o1, DC.o2, DC.o3, DC.o4, DC.o5, DC.o9, DC.o6, DC.o7, DC.o8 ],
                    (power) => {
                        switch ( power ) {
                            case 300: return [ 45, 27, 23, 20, 13, 11, 6, 5, 2.5, 1.3 ];
                            default: return [ 55, 32, 27, 23, 15, 13, 7.2, 6, 3, 1.6 ];
                        }
                    },
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "B 2500",
                    () => () => -1,
                    (vIn) => 400,
                    [ AC.i6, AC.i8, AC.i9a, AC.i9b, AC.i6V ],
                    [ DC.b1, DC.b2, DC.b4, DC.b6, DC.b7, DC.b8 ],
                    (power) => [23, 13, 6.2, 5.1, 2.8, 1.4],
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "C 600",
                    () => () => -1,
                    (vIn) => {
                        switch ( vIn.range.nom ) {
                            case 12: return 300;
                            case 24: return 450;
                            default: return 500;
                        }
                    },
                    [ DC.i2, DC.i3, DC.i4, DC.i5, DC.i7, DC.i8Z, AC.i6, AC.i8, AC.i9a, AC.i9b, AC.i6V ],
                    [ DC.o0, DC.o1, DC.o2, DC.o3, DC.o4, DC.o5, DC.o9, DC.o6, DC.o7, DC.o8 ],
                    (power) => {
                        switch ( power ) {
                            case 300: return [ 50, 30, 25, 20, 12, 10, 6, 5, 2.5, 1.2 ];
                            case 450: return [ 70, 45, 35, 28, 18, 15, 8, 7, 3.5, 1.8 ];
                            default: return [ 80, 50, 40, 32, 20, 17, 9, 7.5, 4, 2 ];
                        }
                    },
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "B 600",
                    () => () => -1,
                    (vIn) => 500,
                    [ AC.i6, AC.i8, AC.i9a, AC.i9b, AC.i6V ],
                    [ DC.b1, DC.b2, DC.b4, DC.b6, DC.b7, DC.b8 ],
                    (power) => [32, 16, 8, 6.4, 3.5, 1.8],
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "C 1500",
                    () => () => -1,
                    (vIn) => {
                        switch ( vIn.range.nom ) {
                            case 12: return 400;
                            case 24: return 500;
                            default: return 600;
                        }
                    },
                    [ DC.i0, DC.i2, DC.i3, DC.i4, DC.i5, DC.i7, DC.i8Z, AC.i6, AC.i8, AC.i9a, AC.i9b, AC.i6V ],
                    [ DC.o0, DC.o1, DC.o2, DC.o3, DC.o4, DC.o5, DC.o9, DC.o6, DC.o7, DC.o7J, DC.o8, DC.o8J ],
                    (power) => {
                        switch ( power ) {
                            case 400: return [ 40, 25, 24, 20, 15, 13, 7, 5.5, 3, 2, 1.4, 1 ];
                            case 500: return [ 60, 38, 33, 25, 18, 15, 8, 6.5, 3.3, 2.5, 1.6, 1.3 ];
                            default: return [ 80, 50, 42, 34, 23, 20, 11, 9, 4.5, 3, 2.4, 1.5 ];
                        }
                    },
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "B 1500",
                    () => () => -1,
                    (vIn) => 600,
                    [ AC.i6, AC.i8, AC.i9a, AC.i9b, AC.i6V ],
                    [ DC.b1, DC.b2, DC.b4, DC.b6, DC.b7, DC.b8 ],
                    (power) => [ 34, 18, 9, 7.5, 4, 2 ],
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "C 2600",
                    () => () => -1,
                    (vIn) => {
                        switch ( vIn.range.nom ) {
                            case 24: return 650;
                            default: return 800;
                        }
                    },
                    [ DC.i2, DC.i3, DC.i4, DC.i5, DC.i7, DC.i8Z, AC.i6, AC.i8, AC.i9a, AC.i9b, AC.i6V ],
                    [ DC.o0, DC.o1, DC.o2, DC.o3, DC.o4, DC.o5, DC.o9, DC.o6, DC.o7, DC.o8 ],
                    (power) => {
                        switch ( power ) {
                            case 650: return [ 85, 65, 50, 42, 25, 22, 12, 10, 5, 2.5 ];
                            default: return [ 100, 75, 60, 50, 30, 27, 15, 12, 6.5, 3.2 ];
                        }
                    },
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "B 2600",
                    () => () => -1,
                    (vIn) => 800,
                    [ AC.i6, AC.i8, AC.i9a, AC.i9b, AC.i6V ],
                    [ DC.b1, DC.b2, DC.b4, DC.b6, DC.b7, DC.b8 ],
                    (power) => [ 50, 25, 13, 10, 6, 3 ],
                    () => cooling.convection, 
                    options
                );

                add_power_converter_family(
                    "C 3600",
                    (vIn) => (vIn, vOut) => {
                        if ( vIn.range.max <= 800 ) return 2256;
                        if ( vIn.range.max <= 640 ) return 1923;
                        return 1764;
                    },
                    (vIn) => {
                        switch ( vIn.range.nom ) {
                            case 24: return 1400;
                            default: return 1700;
                        }
                    },
                    [ DC.i2, DC.i3, DC.i4, DC.i5, DC.i7, DC.i8Z, AC.i6, AC.i8, AC.i9a, AC.i9b, AC.i6V ],
                    [ DC.o0, DC.o1, DC.o2, DC.o3, DC.o4, DC.o5, DC.o9, DC.o6, DC.o7, DC.o8 ],
                    (power) => {
                        switch ( power ) {
                            case 1400: return [ 180, 120, 100, 80, 55, 48, 26, 21, 11, 5.5 ];
                            default: return [ 200, 130, 115, 90, 65, 55, 30, 25, 14, 7 ];
                        }
                    },
                    () => cooling.convection, 
                    options
                );
                
                const allProducts = document.getElementById('all-products');

                for ( const psu of product_list ) {
                    const psu_element = psu.getElement();

                    allProducts.append(psu_element);
                    psu_element.style.display = 'none';
                }


            }

            create_product_list();

            for ( const psu of product_list ) {
                const allProducts = document.getElementById('all-products');
                
                allProducts.append(psu.getElement());
                
            }

            for ( const option of options ) {
                const allOptions = document.getElementById('schaefer-options-selection');

                allOptions.append(option.createElement());
            }

            function doSearch() {
                const in_min = Number(document.getElementById('input-voltage-min').value);
                const in_max = Number(document.getElementById('input-voltage-max').value);
                const in_type = document.getElementById('input-current-type').value;
                const out_min = Number(document.getElementById('output-voltage-nom').value);
                const out_max = Number(document.getElementById('output-voltage-nom').value);
                const out_type = document.getElementById('output-current-type').value;
                const out_current = Number(document.getElementById('output-current').value);
                const options = document.getElementById('option-listing').innerText ?? '';

                for ( const psu of product_list ) {
                    if ( 
                        true
                        // test input
                        && in_min  >= Number(psu.input.getAttribute('min'))
                        && in_max  <= Number(psu.input.getAttribute('max'))
                        && in_type == psu.input.getAttribute('type')
                        // test output
                        && out_min >= Number(psu.output.getAttribute('min'))
                        && out_max <= Number(psu.output.getAttribute('max'))
                        && out_type == psu.output.getAttribute('type')
                        && out_current <= Number(psu.output.getAttribute('current'))
                        // test options
                        && options == (psu.catNumber.getAttribute('options') ?? '')
                    ) {
                        psu.getElement().style.display = 'block';
                    } else {
                        psu.getElement().style.display = 'none';
                    }
                }
            }
        </script>
        <script>
            document.getElementById('exchange-rate-input').value = 0.6;
            document.getElementById('postage-and-insurance-rate-input').value = 35;
            document.getElementById('gross-profit-rate-input').value = 35;
            document.getElementById('output-current').value = 0;
        </script>
    </body>
</html>