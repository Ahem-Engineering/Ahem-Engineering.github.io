<html>
  <head>
    <title>Ahem Engineering - Product tag generator</title>
    <script src="https://git.ahem.net.au/script/qrcode.js"></script>
    <script src="https://git.ahem.net.au/script/JsBarcode.js"></script>
    <script src="https://sdks.shopifycdn.com/js-buy-sdk/v2/latest/index.umd.min.js"></script>
    <script>
    // get parameter - product code
    const params = new URLSearchParams(window.location.search);
    const ahemcode = params.get('product_code');

    // prepare Anew QRCode to fill element id="qrcode"
    var qr_element = document.getElementById("qrcode");
    var qrcode = new QRCode(qr_element, { width : 100, height : 100 });
    
    // prepare ShopifyBuy client
    var client = ShopifyBuy.buildClient(
      {
        domain: 'ahem-engineering.myshopify.com',
        storefrontAccessToken: 'c43dd5285b9eaf2ce09081222ee4c393',
      }
    );
    
    // format request for ShopifyBuy
    var product_request = btoa('gid://shopify/Product/'+"7698399953117");
    
    client.product.fetch(product_request).then((product) => {
      document.getElementById('product-name').innerHTML = product.title;
      
      var product_anchor = document.getElementById('productURL');
      var product_url = "http://shop.ahem.net.au/products/" + product.handle;
      
      product_anchor.innerHTML = product_url;
      product_anchor.href = product_url;
      
      qrcode.makeCode(product_url);
      
      JsBarcode("#barcode", ahemcode, {
        width: 3,
        height: 100,
        text: ahemcode
      });
    
    });
    
    </script>
  </head>
  
  <body>
    <table>
      <tbody>
        <tr>
          <th colspan="2"><div id="product-name"></div></th>
        </tr>
        <tr>
          <td style="width: 100px"><div id="barcode"></div></td>
          <td style="width: 120px"><div id="qrcode"></div></td>
        </tr>
        <tr>
          <td colspan="2"><a id='productURL' href=''></a></td>
        </tr>
      </tbody>
    </table>
  </body>
